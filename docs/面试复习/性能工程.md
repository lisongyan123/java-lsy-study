# 性能的指标

1. 吞吐量: 单位时间处理请求的数量
2. 服务延迟: 客户请求的处理时间
3. 扩展性: 系统在高压的情况下能不能正常处理请求
4. 资源使用效率: 单位请求处理所需要的资源量(比如 CPU, 内存等)

# 性能的外部指标

1. 服务延迟
2. 吞吐率: 单位时间成功处理的请求数和任务数
3. 资源使用率: CPU 使用率低, 吞吐率也低

# 内部瓶颈

1. 软件系统: 操作系统、应用程序、各种类库以及文件系统
2. CPU 和内存: cpu 性能、QPI 和缓存内存
3. 存储和外部 IO
4. 网络: 服务器到机柜交换机的网络、数据中心网络、CDN 和互联网

# 存储系统三大指标

1. IOPS: 每秒能处理读写请求数量
2. 访问延迟和响应时间: 从发起 IO 请求, 存储系统把 IO 处理完成的时间间隔
3. 吞吐率/带宽: 存储系统的实际数据传输速率

# 时空转换

## 时间换空间

1. 改变应用程序本身的数据结构或者数据格式, 减少需要存储的数据大小
2. 压缩算法(ZSTD、LZ4、ZIP, GZIP, SNAPPY, LZ4)压缩内存数据, 使用解压缩, 压缩率越高的算法, 压缩耗时也越高, 对性能要求高的系统,
   可以选择压缩速度快的算法, 比如 LZ4; 如果需要更高的压缩比, 可以考虑 GZIP 或者压缩率更高的 XZ 等算法
3. 内存数据放到外部更便宜的存储系统, 需要再取回

## 空间换时间

预处理和延后处理

# 预先延后处理

## 预先/提前处理(preload 和 prefetch 预取指令)

1. 用不同的优先级来加载资源可以显著提升页面下载性能
2. 很多文件有预读功能, 提前从磁盘读取额外数据, 为下次上层应用程序读取数据做准备, 比如顺序读
3. 缓存预读取(软件/硬件读取)

## 延后/惰性处理

1. 计算推迟到必要执行的时刻, cow(copy on write)
2. 并行/异步操作

# 并行/异步操作

## 并行操作

1. 服务器横向扩展
2. 多线程粒度
3. CPU 多核

**增加吞吐率减少平均等待时间**

## 异步操作

# 缓存/批量合并

1. 批量 IO 读写, 合并成一次读写
2. 对数据库的读写操作, 可以尽量合并对键值数据库查询, 一次查询多个键
3. 合并网络请求

# 算法和高效数据结构

# 伪共享

内存缓存系统以缓存行为单位存储, 多线程修改看似相互独立的变量, 这些变量共享一个缓存行, 无意之中影响彼此性能

![](../.性能工程_images/5db578bf.png)

不同线程数据尽量放到不同缓存行, 避免多线程同时频繁地修改同一个缓存行